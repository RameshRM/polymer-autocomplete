/*! crossdomain-xhr 02-06-2014 */
(function(a){"use strict";"undefined"==typeof a.cXHR&&(a.cXHR={})}).call(this,window),function(a){"use strict";function b(){return f||(g=c(),h=d(g),i=e()),{isXhrEnabled:g,isCorsEnabled:h,isPostMessageEnabled:i}}function c(){return"function"==typeof XMLHttpRequest}function d(a){return a?"withCredentials"in new XMLHttpRequest:void 0}function e(){return"function"==typeof window.postMessage}var f=!1,g=!1,h=!1,i=!1;a.features={get:function(){return b()}}}.call(this,window.cXHR),function(a){"use strict";function b(a){for(var b in d)a.hasOwnProperty(b)&&(e[b]=a[b])}function c(a){return e.hasOwnProperty(a)?e[a]:null}var d={useCORSPolyfill:"useCORSPolyfill",useCORS:"useCORS",useSIFR:"useSIFR",allowedOrigins:"allowedOrigins",sifrGateway:"sifrGateway"};a.XHRConfigKeys=d;var e={},f="sifr.html";cXHR.config={set:function(a){b(a)},get:function(){return e},getByKey:function(a){return c(a)},getAllowedOrigins:function(){var a=null;if("undefined"!=typeof this.getByKey(d.allowedOrigins)&&null!=this.getByKey(d.allowedOrigins)&&(a=this.getByKey(d.allowedOrigins).split(",")),null===a||0===a.length)return{"*":"All"};for(var b=a.length,c={},e=0;b>e;e++)c[a[e]]=a[e];return c},getSifrGateway:function(){var a=this.getByKey(d.sifrGateway);return null===a?f:a},getCorsType:function(){var a=this.getByKey(d.useCORS),b=this.getByKey(d.useSIFR);return a?"cors":b?"sifr":"cors-polyfill"}}}.call(this,window.cXHR),function(a){"use strict";function b(a,b,c){a.attachEvent?a.attachEvent(b,function(){c()}):a.onload=function(){c()}}function c(a){window.clearTimeout(a)}function d(d,e){var f=null;"undefined"!=typeof d.client&&"undefined"!=typeof d.context&&(d.context.appendChild(d.client),f=window.setTimeout(function(){a.contentLoader.abort()},d.timeout),b(d.client,"onload",function(){null!=f&&c(f),"function"==typeof e&&e()}))}var e=200;cXHR.contentLoader={load:function(a,b,c,f){var g={client:a,timeout:b||e,context:c};d(g,f)},abort:function(){window.stop?window.stop():document.execCommand("Stop")}}}.call(this,window.cXHR),function(a,b){"use strict";function c(a){return"undefined"!=typeof a&&null!==a&&a.indexOf("/")>=0?a.split("/"):null}function d(a){var b=c(a),d=0,e=0,f=[];if(null!==b&&b.length>0){e=b.length;for(var g=d;e>g;g++)if(""!==b[g]&&(f.push(b[g].toLowerCase().replace(/ /gi,"")),2===f.length))return f.join("//");return null}return null}b.http={currentUrl:function(){return"undefined"!=typeof a&&null!==a?a.location.href:null},currentDomain:function(){return"undefined"!=typeof a&&null!==a?a.location.hostname:null},urlParts:function(a){return c(a)},urlScheme:function(a){return d(a)},request:{isCrossDomain:function(a,c){var d=b.http.urlScheme(a),e=b.http.urlScheme(c);return d!==e},isCrossDomainRequest:function(a){return this.isCrossDomain(b.http.currentUrl(),a)}}}}.call(this,window,window.cXHR),function(a){"use strict";var b={},c=function(){};a.messagelistener={listenerObject:function(){return new c},subscribe:function(a){b.hasOwnProperty(a)&&b[a]()},listen:function(a,c){b[a]=c},all:b}}.call(this,window.cXHR),function(){cXHR.postMessageData=function(a,b){this.messageId=a,this.data=b}}.call(this,window.cXHR),function(a){"use strict";function b(a){var c=null,d=a.toLowerCase().replace(/ /gi,"");this.targetUrl=d,b.Containers.hasOwnProperty(d)?(c=b.Containers[d],this.isReady=!0):(c=document.createElement("iframe"),c.src=a,this.isReady=!1,b.Containers[d]=c),this.client=c}function c(a,c){return b.Containers.hasOwnProperty(c)?b.Containers[c]:(b.Containers[c]=a,a)}function d(a,b){"undefined"!=typeof a&&"undefined"!=typeof a.src&&null!=a.contentWindow&&"undefined"!=typeof window.postMessage&&a.contentWindow.postMessage(b,a.src)}function e(a){return new b(a)}var f=a.contentLoader;b.Containers={},b.prototype={send:function(a){var b=c(this.client,this.targetUrl),e=JSON.stringify(a);b.style.display="none",b.style.width="0px",b.style.height="0px";var g=this.targetUrl;"undefined"!=typeof f&&f.load(this.client,500,document.body,function(){c(b,g),d(b,e)})},receive:function(){}},a.sifr={getClient:function(a){var b=e(a);return b}}}.call(this,window.cXHR),function(a,b){"use strict";function c(a,b){this.sourceMessageId=null,this.rawMessage=a,this.sender=b,this.isOneWay=!1,this.Id=Date.now(),this.rawMessage=a,this.sender=b,this.isOneWay=!1,this.publishToListener=function(a,b){a(b)}}c.HTTPVERBS={get:"GET",put:"PUT",post:"POST","delete":"DELETE"},"undefined"!=typeof b&&(c.listeners=b.all),c.prototype={packMessageHeaders:function(){},post:function(b,c){var d=this,e=c.messageId,f={status:null,result:null,xhr:null};a.ajax.execute(c.data.method,c.data.url,c.data.settings,function(a,b,c){f.status=a,f.result=b,f.xhr=c,d.onPostComplete(e,f,!1)},function(a,b){d.onPostComplete(e,b,!0)})},onPostComplete:function(a,b,c){var d=c?"undefined"==typeof b.status?500:b.status:200;this.notifySender({messageId:a,status:d,data:b})},parseMessage:function(a){var b=a;return"string"==typeof a&&(b=JSON.parse(a)),b?(b.hasOwnProperty("isOneWay")&&(this.isOneWay=b.isOneWay),b.isRestful=!1,b.hasOwnProperty("data")&&(b.isRestful=b.data.hasOwnProperty("method")&&b.data.hasOwnProperty("url")?c.HTTPVERBS.hasOwnProperty(b.data.method.toLowerCase()):!1),b.hasOwnProperty("messageId")&&c.listeners.hasOwnProperty(b.messageId)&&c.listeners.hasOwnProperty(b.messageId)&&this.publishToListener(c.listeners[b.messageId],b),b):{}},notifySender:function(a){return this.isOneWay?!1:void this.sender.source.postMessage(JSON.stringify(a),"*")}},a.sifrMessenger={process:function(a,b){var d=new c(a,b);d.message=d.parseMessage(d.rawMessage),d.message.isRestful&&d.post(d.message.isRestful,d.message)}}}.call(this,window.cXHR,window.cXHR.messagelistener),function(a,b){"use strict";function c(a){return null!==g?g.hasOwnProperty("*")?!0:g.hasOwnProperty(a):!1}function d(){return"undefined"!=typeof a&&"undefined"!=typeof a.onmessage?!0:!1}function e(){d()&&(window.attachEvent?window.attachEvent("onmessage",function(a){f(a)}):a.onmessage=function(a){f(a)})}function f(a){if("undefined"!=typeof a&&"undefined"!=typeof b)if(c(a.origin))b.process(a.data,{origin:a.origin,source:a.source});else{var d={status:401,data:{error:"Unauthorized Request"}};a.source.postMessage(JSON.stringify(d),"*")}}var g=null;"undefined"!=typeof a.cXHR&&"undefined"!=typeof a.cXHR.config&&(g=a.cXHR.config.getAllowedOrigins()),e()}.call(this,window,window.cXHR.sifrMessenger),function(a){"use strict";function b(a){if("undefined"==typeof a||null===a)return{};var b={};try{"function"==typeof a.getAllResponseHeaders()&&(b=a.getAllResponseHeaders())}catch(c){}var d={response:a.response,responseType:a.responseType,status:a.status,statusText:a.statusText,allResponseHeaders:b,getAllResponseHeaders:function(){return allResponseHeaders}};return d}function c(b,c,d){this.targetUrl=c,this.inputArgs=null,this.httpRequest=null,this.httpVerb=b||"GET",this.headers=null,this.responseType="text",this.clientToken=null,this.corsType=a.config.getCorsType(),this.sifrGateway=a.config.getSifrGateway(),this.xhrFeatures=a.features.get(),this.prepareRequest(c,d,a.http)}function d(a){var b=null;return null!==a&&(b="object"==typeof a?JSON.stringify(a):a),b}function e(a,b){for(var c in b)b.hasOwnProperty(c)&&a.setRequestHeader(c,b[c])}function f(a,b){return"undefined"==typeof b?a:"text"===b?a:"json"===b?JSON.parse(a):a}c.prototype={prepareRequest:function(b,c,e){var f=new XMLHttpRequest;this.SIFR=null,"undefined"!=typeof c&&("undefined"!=typeof c.data&&(this.inputArgs=d(c.data)),"undefined"!=typeof c.headers&&(this.headers=c.headers),"undefined"!==c.dataType&&(this.responseType=c.dataType),"undefined"!==c.timeout&&(this.timeout=c.timeout)),this.settings=c,this.isCrossDomainRequest=e.request.isCrossDomainRequest(b),this.isCrossDomainRequest&&("sifr"===this.corsType||"cors-polyfill"===this.corsType&&!this.xhrFeatures.isCorsEnabled)&&(this.SIFR=a.sifr.getClient(e.urlScheme(b)+"/"+this.sifrGateway)),this.httpRequest=f},execute:function(a,b){var d=null,f=this;return null!==this.SIFR?void this.executeSIFR(a,b):(this.httpRequest.onreadystatechange=function(){this.readyState===c.readyStates.complete&&(null!=d&&window.clearTimeout(d),f.onComplete(f.httpRequest.status,f.httpRequest.responseText,a,b))},this.httpRequest.open(this.httpVerb,this.targetUrl),e(this.httpRequest,this.headers),null!=this.clientToken&&e(this.httpRequest,{Authorization:this.clientToken}),null===this.inputArgs?this.httpRequest.send():this.httpRequest.send(this.inputArgs),void(null!=this.timeout&&(d=window.setTimeout(function(){f.httpRequest.abort(),f.onComplete(408,{error:"TimeOut",errorMessage:"Your Request Has Timed Out"},a,b)},this.timeout))))},onComplete:function(a,b,c,d){if(0!==a)if(this.xhrResponse=this.patchResponse(this.httpRequest),200===a)"function"==typeof c&&c.call(this,a,f(b,this.responseType),this.xhrResponse);else{var e={status:a,errorMessage:b};"function"==typeof d&&d.call(this,a,e,this.xhrResponse)}},patchResponse:function(a){return"undefined"!=typeof a&&null!==a?b(a):null},onSifrRequestComplete:function(a,b,c,d,e){200===a?"function"==typeof d&&d.call(this,a,b.data,c):"function"==typeof e&&e.call(this,a,b.data,c)},executeSIFR:function(b,c){var d="function"==typeof window.postMessage||"object"==typeof window.postMessage;if(d&&"undefined"==typeof JSON&&(d=!1),!d)return this.onSifrRequestComplete(405,{error:"Method Not Allowed",errorMessage:"Cross Domain Requests are not allowed"},null,b,c),!1;var e=this,f=new a.postMessageData(Date.now(),{method:this.httpVerb,url:this.targetUrl,settings:this.settings});this.SIFR.send(f,null),a.messagelistener.listen(f.messageId,function(a){var d=null;"undefined"!=typeof a&&(d="undefined"!=typeof a.data?a.data.xhr:null,e.onSifrRequestComplete(a.status,a,d,b,c))})}},c.readyStates={uninitialized:0,loading:1,loaded:2,interactive:3,complete:4},a.ajax={GET:function(a,b,c,d){this.execute("GET",a,b,c,d)},PUT:function(a,b,c,d){this.execute("PUT",a,b,c,d)},POST:function(a,b,c,d){this.execute("POST",a,b,c,d)},execute:function(a,b,d,e,f){var g=new c(a,b,d);g.execute(e,f)}}}.call(this,window.cXHR,window.cXHR.http);